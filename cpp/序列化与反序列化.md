# 序列化与反序列化

## 什么是序列化和反序列化
- 序列化
将数据结构或对象转换成二进制串的过程
- 反序列化
将序列化产生的二进制串转换成数据结构或对象的过程

## 序列化的格式
- 文本格式：JSON、XML
- 二进制格式：protobuf (google开源)

## 二进制序列化
数据小、传输速度快、序列化和反序列化速度快

## 编码
类型 +（长度）+ 数据
用一个枚举来区分支持序列化的类型

自定义的编码：约定一些信息编码在前面，然后后面跟数据，**对偏移量要求很严格**

## proto
普通的编码不**具备可扩展性**(类增加新的成员，需要重构以前的编码方式)
- 写proto文件
```
syntax = "proto3";//标准，proto3不推荐required

package bplustree;//包名，命名空间

message BPlusTree{
    optional uint64 _MAX_SIZE= 1;
    optional string _name = 2;
    optional string _root = 3;
}

//数组类型用repeated
message BNode{
    repeated int64 _key = 1;
    optional bool _isLeaf = 2;
    optional uint64 _keyNum = 3;
    optional string _uuid = 4; //节点uuid
    repeated uint64 _value = 5;
    repeated string _child = 6;
    optional string _prev = 7;
    optional string _next = 8;
}

```

- 安装protoc编译器
```
sudo apt install protobuf-compiler
```
- 编译proto文件
```
protoc -I=srcDir --cpp_out=dstDir srcPath --experimental_allow_proto3_optional

eg：
protoc -I=./ --cpp_out=./ ./bplustree.proto --experimental_allow_proto3_optional
```

## uuid
- 先安装uuid，就可以包含头文件`<uuid/uuid.h>`
```
sudo apt-get install uuid-dev
```
- 使用
```
uuid_generate();
uuid_generate_random();
```
- CMake链接库
```
先找一下库的位置:
dpkg -L uuid-dev

然后在CMakeLists里面链接：
target_link_libraries(main /usr/lib/x86_64-linux-gnu/libuuid.so)
```

#### uuid是什么？
Universally Unique Identifier,通用唯一识别码
长度128位(16字节)，换算为16进制就是32个字符，按照8-4-4-4-12，加上中间的`-`，一共**36**个字符