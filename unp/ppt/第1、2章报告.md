## 包裹函数

- 约定**首字母大写**
- 完成实际的函数调用，检查返回值，并在发生错误时进行处理
- 可以轻松地修改原函数的行为，例如添加日志、异常处理等功能

## Unix errno值
- `Unix`函数中有错误发生，就会把**全局变量**`errno`置为该错误类型的正值，函数本身通常返回`-1`
- 正数错误值都是常值，`E`开头的全大写字母名字，通常在头文件`<sys/errno.h>`中定义
- 值0不表示任何错误
- 多线程不适合（互相干扰）

## 原始套接字
网络应用绕过传输层直接使用`IPv4`或`IPv6`，甚至可以彻底绕过IP层直接读写数据链路层的帧

## IP数据报
`从源端到目的端的传送过程中，分片操作既可能发生在源端，也可能发生在途中`

发生在途中：**不同路由器有自己的MTU**

## TCP三次握手

![Alt text](../res/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

### 为什么？

- 为了保证**通路**的可靠性

服务器收到第一个SYN(确认到**客户端发送**没问题)
客户端收到服务器返回的SYN和ACK(确认到服务器的**发送和接收**都没问题)
服务器收到客户端返回的ACK(才确认到**客户端接收**没问题)

- 为了保证**数据**的可靠性

TCP是全双工的，客户端和服务端各自维护了一个序列号来跟踪发送的数据是否全部送到。如果只有两次握手，只有客户端的序列号是被协商好了，而服务端的还没有被确认。

### ISN(Initial Sequence Number)是随机的

#### 序列号为啥随机生成？

- 如果不随机，假设每次从固定值开始。黑客容易黑到。

- 如果不随机，**更加难以**辨别旧连接与新连接。

### 握手时是否可以携带数据

**第三次握手是可以携带数据的，前两次握手是不可以携带数据的**

## TCP四次挥手

![Alt text](../res/TCP%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png)

### 为什么？即二三次为什么不合在一起？

- 确保数据的完整性，确保对方不会再发送数据

服务器如果收到FIN就立即关闭会导致部分数据没有收到，数据不完整

- 服务器如果将ACK滞后到FIN一起发，客户端会以为自己发的FIN丢失了，而重新发，导致资源浪费

### 为什么客户端在TIME-WAIT阶段要等2MSL?

- 可靠地实现TCP全双工连接的终止
防止客户端发的ACK丢失

- 允许老的重复分节在网络中消逝
关闭连接后，重新建立一个新的连接，TCP必须防止上一个连接的重复分组再现。

## SCTP四次握手

![Alt text](../res/SCTP%E5%9B%9B%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

### 为什么？
差别主要是cookie，客户端与服务器都要确保cookie是正确的。

## SCTP三次挥手

![Alt text](../res/SCTP%E4%B8%89%E6%AC%A1%E6%8C%A5%E6%89%8B.png)

### 为什么？
- SCTP有验证标记值，以区分旧连接跟新连接。